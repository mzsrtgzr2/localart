# Search

<!-- Map of Israel -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<div id="artist-map" style="height: 350px; margin-bottom: 32px; border-radius: 8px; overflow: hidden;"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
var map, markers = [], artistData;
document.addEventListener('DOMContentLoaded', function() {
  map = L.map('artist-map').setView([31.5, 34.8], 8); // Center on Israel
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);
  artistData = {{ map_points | tojson }};
  artistData.forEach(function(artist) {
    var marker = L.marker([artist.lat, artist.lon]).addTo(map);
    marker.bindPopup('<b>' + artist.artist_name + '</b><br>' + (artist.city || '') + (artist.area ? ', ' + artist.area : ''));
    marker.on('click', function() {
      filterArtistsByLocation(artist.lat, artist.lon);
    });
    markers.push({ marker: marker, lat: artist.lat, lon: artist.lon, city: artist.city, area: artist.area });
  });
  window.resetArtistFilter = function() {
    document.getElementById('city-filter').value = '';
    document.getElementById('tag-filter').value = '';
    filterArtists();
    map.setView([31.5, 34.8], 8);
  }
});
function filterArtistsByLocation(lat, lon) {
  var cards = document.querySelectorAll('.artist-card');
  cards.forEach(function(card) {
    var clat = card.getAttribute('data-lat');
    var clon = card.getAttribute('data-lon');
    card.style.display = (clat == lat && clon == lon) ? '' : 'none';
  });
  map.setView([lat, lon], 12);
}
function filterArtists() {
  var city = document.getElementById('city-filter').value;
  var tag = document.getElementById('tag-filter').value;
  var cards = document.querySelectorAll('.artist-card');
  var found = false;
  var bounds = [];
  cards.forEach(function(card) {
    var match = true;
    if (city && card.getAttribute('data-city') !== city) match = false;
    if (tag) {
      var tags = card.getAttribute('data-tags').split(',');
      if (tags.indexOf(tag) === -1) match = false;
    }
    card.style.display = match ? '' : 'none';
    if (match && card.getAttribute('data-lat') && card.getAttribute('data-lon')) {
      bounds.push([parseFloat(card.getAttribute('data-lat')), parseFloat(card.getAttribute('data-lon'))]);
      found = true;
    }
  });
  if (found && bounds.length > 0) {
    if (bounds.length === 1) {
      map.setView(bounds[0], 12);
    } else {
      map.fitBounds(bounds, {padding: [30, 30]});
    }
  } else {
    map.setView([31.5, 34.8], 8);
  }
}
</script>

<!-- Filter UI -->
<div style="margin-bottom: 24px;">
  <label for="city-filter"><b>Filter by City:</b></label>
  <select id="city-filter" onchange="filterArtists()">
    <option value="">All Cities</option>
    {% for city in cities %}
      <option value="{{ city }}">{{ city }}</option>
    {% endfor %}
  </select>
  <label for="tag-filter" style="margin-left:16px;"><b>Filter by Tag:</b></label>
  <select id="tag-filter" onchange="filterArtists()">
    <option value="">All Tags</option>
    {% for tag in allowed_tags %}
      <option value="{{ tag }}">{{ tag }}</option>
    {% endfor %}
  </select>
  <button onclick="resetArtistFilter()" style="margin-left:16px;">Reset</button>
</div>

<div id="artist-grid" style="display: flex; flex-wrap: wrap; gap: 32px; justify-content: flex-start;">
{% for entry in showcase %}
  <div class="artist-card" data-city="{{ entry.city }}" data-lat="{{ entry.lat }}" data-lon="{{ entry.lon }}" data-tags="{{ entry.img_tags|join(',') }}" style="text-align:center; width:220px; margin-bottom:32px; position:relative;">
    <a href="{{ base_url }}/artists/{{ entry.slug }}/" style="display:inline-block;">
      <span style="position:relative; display:inline-block;">
        <img src="{{ base_url }}/assets/artists/{{ entry.slug }}/{{ entry.img_file | urlencode }}" alt="{{ entry.artist_name }}" style="width:200px; height:200px; object-fit:cover; border-radius:8px; box-shadow:0 2px 8px #0001;" />
      </span>
    </a>
    <div style="margin-top:8px; font-weight:bold; font-size:1.1em;">
      <a href="{{ base_url }}/artists/{{ entry.slug }}/" style="text-decoration:none; color:inherit;">{{ entry.artist_name }}</a>
    </div>
    {% if entry.img_title %}
    <div style="font-size:0.9em; color:#666;">{{ entry.img_title }}</div>
    {% endif %}
    {% if entry.img_tags %}
    <div style="margin-top:4px;">
      {% for tag in entry.img_tags %}
        <a href="{{ base_url }}/tags/{{ tag }}" style="background:#eee; color:#333; border-radius:4px; padding:2px 6px; margin-right:4px; font-size:0.85em; text-decoration:none;">{{ tag }}</a>
      {% endfor %}
    </div>
    {% endif %}
    <div class="img-details" tabindex="-1" style="display:none; position:absolute; left:0; top:220px; width:100%; background:#fff; border:1px solid #ccc; border-radius:8px; box-shadow:0 2px 12px #0002; z-index:10; padding:16px; text-align:left;">
      <b>{{ entry.img_title }}</b><br>
      Size: {{ entry.img_size }}<br>
      Medium: {{ entry.img_medium }}<br>
      Date: {{ entry.img_date }}<br>
      {% if entry.img_tags %}
      <div style="margin-top:4px;">
        {% for tag in entry.img_tags %}
          <span style="background:#eee; color:#333; border-radius:4px; padding:2px 6px; margin-right:4px; font-size:0.85em;">{{ tag }}</span>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
{% endfor %}
</div>
<script>
function showDetails(link) {
  // Hide any open details
  document.querySelectorAll('.img-details').forEach(function(d) { d.style.display = 'none'; });
  var details = link.parentElement.querySelector('.img-details');
  if (details) {
    details.style.display = 'block';
    details.focus();
    // Hide on focus out
    details.onblur = function() { details.style.display = 'none'; };
  }
}
document.addEventListener('click', function(e) {
  if (!e.target.closest('.artist-card')) {
    document.querySelectorAll('.img-details').forEach(function(d) { d.style.display = 'none'; });
  }
});
</script>
